<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
   <meta name="GENERATOR" content="Mozilla/4.61 [en] (X11; I; Linux 2.2.12-20 i686) [Netscape]">
   <title>Generic Image Language</title>
</head>
<body text="#000000" bgcolor="#FFFFFF" link="#0000FF" vlink="#840084" alink="#0000FF">

<div 
CLASS="ARTICLE"
>
<div 
CLASS="TITLEPAGE"
>
<h1 CLASS="TITLE">
<a NAME="AEN2"></a><font size=+2>Generic Image Language</font></h1>

<div CLASS="AUTHOR"><font size=+0>Calvin Williamson</font>
<br>calvinw@mindspring.com
<p>Caroline Dahll&ouml;f
<br>caro@rhythm.com</div>

<div CLASS="AUTHOR">&nbsp;</div>

<div CLASS="AUTHOR"><font size=+0>This document describes some parts of
a generic image language that can be used to describe algorithms in gegl,
or other&nbsp; image processing situations.&nbsp; This is a type of embedded
language, and blocks of the image language code can be mixed with regular
C code with some restrictions. These blocks are then processed with lex/yacc
to generate versions of the algorithms for different color models (including
channel data types) and data storage types. This language is meant to be
useful for writing algorithms in a very generic way for use with several
different formats and data types. The <b><tt>Chan</tt></b> and <b><tt>VectorChan</tt></b>
data types from <a href="http://www.mindspring.com/~calvinw/genericChannelData.html">Generic
Channel Data</a> are used to describe generic pixel data and image processing
operations on that data.</font></div>

<div 
CLASS="AFFILIATION"
>
<div 
CLASS="ADDRESS"
>
<div CLASS="ADDRESS">&nbsp;</div>
</div>
</div>

<hr></div>

<div 
CLASS="TOC"
>
<dl 
>
<dt>
<b>Generic Image Language</b></dt>

<dt>
<a href="#Color Model Specifications">Color Model Specifications</a></dt>

<dt>
<a href="#Generic Image Language Structure">Generic Image Language Structure</a></dt>

<dt>
<a href="#Declaration Block">Declaration Block</a></dt>

<dt>
<a href="#Image Data Init Marker">Image Data Init Marker</a></dt>

<dt>
<a href="#Other Blocks">Other Blocks</a></dt>

<dt>
<a href="#Iterators">Iterators</a></dt>

<dt>
<a href="#Generic Image Language Program">Generic Image Language Program</a></dt>

<dt>
<a href="#Codegen">Codegen</a></dt>

<dt>
<a href="#Channel Data File">Channel Data File</a></dt>

<dt>
<a href="#Multiple Programs Per File">Multiple Programs Per File</a></dt>

<br>
<hr></dl>
</div>

<div 
CLASS="SECT1"
>
<h1 CLASS="SECT1">
<a NAME="Color Model Specifications"></a><font size=+2>Color Model Specifications</font></h1>

<div CLASS="AUTHOR"><font size=+0>To generate code for a particular color
model and data storage, the color model must specify details about the
channel data type and the names of the channels.&nbsp; In addition some
data storage details might be passed to the code generator as well.</font>
<p><font size=+0>The color model specification of the channel data type
is done by providing the definitions and macros of the <b><tt>Chan </tt></b>type
from
<a href="http://www.mindspring.com/~calvinw/genericChannelData.html">Generic
Channel Data</a> document. This involves defining a channel data type,
white point, and multiplication, clamping and rounding macros for the data
type. It also may involve a specification of a promotion data space for
use in calculations where overflow may occur. (eg <b><tt>uint8</tt></b>s
usually use the <b><tt>int</tt></b> data type in calculations where overflow
might occur.)</font>
<p><font size=+0>The above information is passed to the code generator
in a file called the <a href="#Channel Data File">Channel Data File</a>
as described in&nbsp; <a href="#Codegen">Codegen</a>.</font></div>
</div>

<div 
CLASS="SECT1"
>
<hr>
<h1 CLASS="SECT1">
<a NAME="Generic Image Language Structure"></a><font size=+2>Generic Image
Language Structure</font></h1>
</div>

<div 
CLASS="SECT1"
>The generic image language is an embedded language.
Blocks of code are placed inside functions that are to be generated.&nbsp;
The blocks of generic code are then rewritten as normal C code by running
the function through the code generator. The code generator is a lex/yacc
program that reads the<b><tt> GENERIC_IMAGE</tt></b> blocks, and re-writes
the generic code according to the color models of the various images involved
and the types of functions being generated. The typical structure of generic
image language code inside a function has several blocks:
<p><b><tt>some_function</tt></b>
<br><b><tt>{</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_DECL_BEGIN</tt></b>
<br><b><tt>&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*one declaration block*/</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_DECL_END</tt></b>
<p><b><tt>&nbsp; /* regular C code */</tt></b>
<p><b><tt>&nbsp; GENERIC_IMAGE_DATA_INIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*one data init marker*/</tt></b>
<p><b><tt>&nbsp; /* regular C code */</tt></b>
<p><b><tt>&nbsp; GENERIC_IMAGE_BLOCK_BEGIN</tt></b>
<br><b><tt>&nbsp; ...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*one or more code blocks*/</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_BLOCK_END</tt></b>
<p><b><tt>}</tt></b>
<p>Inside this function, there is one declaration block, one image data
initialization marker, and then one or more generic code blocks each containing
generic code.
<p>
<hr>
<h1 CLASS="SECT1">
<a NAME="Declaration Block"></a><font size=+2>Declaration Block</font></h1>

<div CLASS="SECT1">The declaration block is where you declare the pixel
data variables for the images you will process. Roughly you will have a
<b><tt>VectorChan</tt></b>
variable for each different reference to pixels in the source(s) or dest
images you are processing.&nbsp; The declaration block also includes any
additional <b><tt>Chan</tt></b> variables (single channel data elements)
that are used in the code blocks below. Also regular C data types may be
declared here so that they can be used in the code blocks below.&nbsp;
There are no pointers or arrays of <b><tt>Chan</tt></b> or <b><tt>VectorChan</tt></b>
variables allowed.&nbsp; No pointers or arrays or structs of C data types
are allowed either. The <b><tt>VectorChan</tt></b> declarations for pixels
comes in three forms:
<p>1)
<p><b><tt>VectorChan d(color,alpha);</tt></b>
<br>&nbsp;</div>

<div CLASS="SECT1">means <b><tt>d</tt></b> has both color both alpha channel<b><tt>.</tt></b>
<br><b><tt></tt></b>&nbsp;</div>

<div CLASS="SECT1">2)
<p><b><tt>VectorChan d(color);</tt></b>
<br>&nbsp;</div>

<div CLASS="SECT1">means <b><tt>d </tt></b>has only color channels. There
is no alpha.
<br>&nbsp;
<div CLASS="SECT1">3)
<p><b><tt>VectorChan d(color,alpha, has_alpha);</tt></b>
<br>&nbsp;</div>

<div CLASS="SECT1">means <b><tt>d </tt></b>has color channels and an optional
alpha channel.</div>
</div>

<div CLASS="SECT1">&nbsp;
<br>Before processing any of the code blocks below the declaration block,
codegen adds some additional variables implicitly for each of the above
declarations. The extra variables are called <b><tt>d_color</tt></b>, <b><tt>d_alpha</tt></b>
and <b><tt>d_has_alpha.
</tt></b>This is so the programmer can use these
expressions in the algorithm code. <b><tt>d_color
</tt></b>is a vector
shorthand for the color channels,<b><tt>d_alpha
</tt></b>refers to just
the alpha channel, and <b><tt>d_has_alpha </tt></b>is a boolean that is
available to check for the optional alpha case.
<p>For
<p><b><tt>VectorChan d(color,alpha);</tt></b>
<p>internally codgen really "declares" all three of&nbsp; <b><tt>VectorChan
d</tt></b>, <b><tt>VectorChan d_color,</tt></b> and <b><tt>Chan d_alpha</tt></b>
with <b><tt>d = (d_color,d_alpha)</tt></b>.
<p>The dimension of the <b><tt>VectorChan</tt></b> <b><tt>d_color</tt></b>
is&nbsp; the number of color channels from <b><tt>COLORSPACE</tt></b>.
The dimension of the <b><tt>VectorChan</tt></b> <b><tt>d</tt> </b>is the
number of color channels + 1.&nbsp; And <b><tt>d_alpha
</tt></b>is declared
to be a <b><tt>Chan </tt></b>type since it is 1-dimensional.
<p>For
<p><b><tt>VectorChan d(color);</tt></b>
<p>internally codegen really "declares" <b><tt>VectorChan d</tt></b> and
<b><tt>VectorChan d_color</tt></b> with <b><tt>d = d_color</tt></b>.
<p>Again the dimension of the <b><tt>VectorChan</tt></b> <b><tt>d_color</tt></b>
is number of color channels from <b><tt>COLORSPACE</tt></b>. The dimension
of the <b><tt>VectorChan d </tt></b>is equal to the dimension of <b><tt>d_color</tt></b>
in this case.
<p>For<b><tt></tt></b>
<p><b><tt>VectorChan d(color,alpha,has_alpha);</tt></b><b><tt></tt></b>
<p>internally codegen really "declares" <b><tt>VectorChan d</tt></b>, <b><tt>VectorChan
d_color,</tt></b> <b><tt>Chan d_alpha</tt></b> , and a <b><tt>boolean d_has_alpha</tt></b>.
Here <b><tt>d = (d_color, d_alpha)</tt></b> .
<p>The dimension of the <b><tt>VectorChan</tt></b> <b><tt>d_color</tt></b>
is&nbsp; the number of color channels from <b><tt>COLORSPACE</tt></b>.
The dimension of the <b><tt>VectorChan</tt></b> <b><tt>d</tt> </b>is the
number of color channels + 1.&nbsp; And <b><tt>d_alpha
</tt></b>is declared
to be a <b><tt>Chan </tt></b>type since it is 1-dimensional.&nbsp; The
variable<b><tt> d_has_alpha </tt></b>is a boolean that must be set by the
host C code before the <b><tt>GENERIC_IMAGE_DATA_INIT</tt></b> marker<b><tt>.</tt></b>
<p>Lets look at the code generated for each of the declarations above for
some color models:
<p><b><tt><u>examples:</u></tt></b>
<p><b><tt>1) rgb u8</tt></b>
<blockquote>For
<p><b><tt>VectorChan d(color,alpha);</tt></b>
<p>Then the code generated for C will look like this:
<p><b><tt>guint8 * d_r;</tt></b>
<br><b><tt>guint8 * d_g;</tt></b>
<br><b><tt>guint8 * d_b;</tt></b>
<br><b><tt>guint8 * d_a;</tt></b>
<br><b><tt>guint8 * d_data[4];</tt></b>
<p>For
<p><b><tt>VectorChan d(color);</tt></b>
<p>the generated code will look like this:
<p><b><tt>guint8 * d_r;</tt></b>
<br><b><tt>guint8 * d_g;</tt></b>
<br><b><tt>guint8 * d_b;</tt></b>
<br><b><tt>guint8 * d_data[3];</tt></b>
<p>For
<p><b><tt>VectorChan d(color,alpha,has_alpha);</tt></b>
<p>the generated code will look like this:
<p><b><tt>guint8 * d_r;</tt></b>
<br><b><tt>guint8 * d_g;</tt></b>
<br><b><tt>guint8 * d_b;</tt></b>
<br><b><tt>guint8 * d_a;</tt></b>
<br><b><tt>guint8 * d_data[4];</tt></b>
<br><b><tt>gboolean d_has_alpha;</tt></b></blockquote>
<b><tt>2) gray float</tt></b>
<blockquote>For
<p><b><tt>VectorChan d(color,alpha);</tt></b>
<p>then the code generated will look like this:
<p><b><tt>gfloat * d_gray;</tt></b>
<br><b><tt>gfloat * d_a;</tt></b>
<br><b><tt>gfloat * d_data[2];</tt></b>
<p>For
<p><b><tt>VectorChan d(color);</tt></b>
<p>the generated code will look like this:
<p><b><tt>gfloat * d_gray;</tt></b>
<br><b><tt>gfloat * d_data[1];</tt></b><b><tt></tt></b>
<p>For
<p><b><tt>VectorChan d(color,alpha,has_alpha);</tt></b>
<p>the generated code will look like this:
<p><b><tt>gfloat * d_gray;</tt></b>
<br><b><tt>gfloat * d_a;</tt></b>
<br><b><tt>gfloat * d_data[2];</tt></b>
<br><b><tt>gboolean d_has_alpha;</tt></b></blockquote>
</div>

<div 
CLASS="SECT2"
>
<hr>
<h1 CLASS="SECT2">
<a NAME="Image Data Init Marker"></a><font size=+2>Image Data Init Marker</font></h1>

<div CLASS="SECT2">
<div CLASS="SECT2">During the code generation stage above, an array of
pointers to channel data is generated. If the <b><tt>VectorChan </tt></b>variable
is called <tt><b>d</b>,</tt> then this array is named <b><tt>d_data</tt></b>.
In the C code after <b><tt>GENERIC_IMAGE_DECL_END </tt></b>and before the
<b><tt>GENERIC_IMAGE_DATA_INIT</tt></b>,
<b>d_data</b>
should be initialized by the C code to contain valid pointers to the image
pixel data.&nbsp; Then during code generation, at the <b><tt>GENERIC_IMAGE_DATA_INIT</tt></b>
marker the individual channel pointers are set from this <b><tt>d_data</tt></b>
array. This looks something like this:
<p><b><tt><u>example:</u></tt></b>
<p><b><tt>1) rgb u8</tt></b>
<blockquote>The code generated at <b><tt>GENERIC_IMAGE_DATA_INIT</tt></b>
for a <b><tt>VectorChan d(color,alpha) </tt></b>declaration:
<p><b><tt>d_r = d_data[0];</tt></b>
<br><b><tt>d_g = d_data[1];</tt></b>
<br><b><tt>d_b = d_data[2];</tt></b>
<br><b><tt>d_a = d_data[3];</tt></b>
<p>The generated code for <b><tt>VectorChan d(color)</tt></b>:
<p><b><tt>d_r = d_data[0];</tt></b>
<br><b><tt>d_g = d_data[1];</tt></b>
<br><b><tt>d_b = d_data[2];</tt></b><b><tt></tt></b>
<p>The generated code for <b><tt>VectorChan d(color,alpha,has_alpha)</tt></b>:
<p><b><tt>d_r = d_data[0];</tt></b>
<br><b><tt>d_g = d_data[1];</tt></b>
<br><b><tt>d_b = d_data[2];</tt></b>
<br><b><tt>if (d_has_alpha)</tt></b>
<br><b><tt>&nbsp;&nbsp; d_a = d_data[3];</tt></b></blockquote>
This just initializes the individual channel pointers to the correct data.&nbsp;
In the third case above <b><tt>d_has_alpha</tt></b> must be set by the
C code between <b><tt>GENERIC_IMAGE_DECL_END</tt></b>&nbsp;and <b><tt>GENERIC_IMAGE_DATA_INIT</tt></b>.
<br>
<hr>
<h1 CLASS="SECT2">
<a NAME="Other Blocks"></a><font size=+2>Other Blocks</font></h1>
Finally the rest of the codegen blocks are for specifications of regular
image algorithms. The code usually contains the <b><tt>VectorChan </tt></b>variables
for the images being processed plus any additional variables needed to
specify the algorithm.
<p><b><u>example:</u></b>
<p><b><tt>some_func_COLORSPACE_DATATYPE (...)</tt></b>
<br><b><tt>{</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_DECL_BEGIN</tt></b>
<br><b><tt>&nbsp; VectorChan d(color,alpha);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*one declaration block*/</tt></b>
<br><b><tt>&nbsp; VectorChan s(color,alpha);</tt></b>
<br><b><tt>&nbsp; Chan c;</tt></b>
<br><b><tt>&nbsp; float f;</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_DECL_END</tt></b>
<p><b><tt>&nbsp; /* regular C code */</tt></b>
<p><b><tt>&nbsp; GENERIC_IMAGE_DATA_INIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*one data init marker*/</tt></b>
<p><b><tt>&nbsp; /* regular C code */</tt></b>
<p><b><tt>&nbsp; GENERIC_IMAGE_BLOCK_BEGIN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*just one code block this time*/</tt></b>
<br><b><tt>&nbsp; d_color = c * s_color;</tt></b>
<br><b><tt>&nbsp; d_alpha = f * s_alpha;</tt></b>
<p><b><tt>&nbsp; dX(d,1);</tt></b>
<br><b><tt>&nbsp; dX(s,1);</tt></b>
<br><b><tt>&nbsp; GENERIC_IMAGE_BLOCK_END</tt></b>
<br><b><tt>}</tt></b>
<p>The use of the dX iterator is described below.
<div CLASS="SECT2">
<div CLASS="SECT2">
<hr></div>
</div>
</div>
</div>
</div>

<div 
CLASS="SECT2"
>
<h1 CLASS="SECT2">
<a NAME="Iterators"></a><font size=+2>Iterators</font></h1>
Here is the mechanism for indicating movement around the image. We must
specify motion in x and motion in y. For now the motion is specified in
integer (x,y) coordinates and assumes the image data has established a
valid rectangle and the <b><tt>GENERIC_IMAGE_DATA_INIT</tt></b> has been
called.
<p>For the declarations:
<p><b><tt>VectorChan d(color,alpha);</tt></b>
<br><b><tt>VectorChan s(color,alpha,has_alpha);</tt></b>
<p>here are some relative iterators for d and s:
<p><b><tt>dX(d,1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*increment d data by 1 in x direction */</tt></b>
<br><b><tt>dX(s,2);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*increment s data by 2 in x direction */</tt></b>
<br><b><tt>dX(s,-1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*decrement
s data by 1 in x direction */</tt></b>
<br><b><tt>dY(d,1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*increment d data by 1 in y direction */</tt></b>
<br><b><tt>dXY(d,1,2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*increment
d data by (1,2) */</tt></b></div>
</div>

<div 
CLASS="SECT1"
>
<div 
CLASS="FORMALPARA"
>
<div CLASS="SECT1">&nbsp;
<br>Heres some absolute position commands for d and s:</div>
</div>
</div>

<div 
CLASS="SECT1"
><b><tt>X(d,0);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*move d data to x-position 0*/</tt></b>
<br><b><tt>Y(d,1);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
/*move d data to y-position 1*/</tt></b>
<br><b><tt>XY(d,2,3);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; /*move d data
to position (2,3) */</tt></b>
<p>Note that directly after <b><tt>GENERIC_IMAGE_DATA_INIT d</tt></b> will
have position given by <b><tt>XY(d,0,0)</tt></b>.
<p>Lets look at the code generated for some of the above iterators and
positions:
<p><b><tt><u>examples:</u></tt></b>
<p><b><tt>1)</tt></b>
<blockquote><b><tt>dX(d,1);</tt></b>
<p>generates code like this for <b><tt>u8 rgb</tt></b>:
<p><b><tt>d_r++;</tt></b>
<br><b><tt>d_g++;</tt></b>
<br><b><tt>d_b++;</tt></b>
<br><b><tt>d_a++;</tt></b></blockquote>
<b><tt>2)</tt></b>
<br><b><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dX(d,2);</tt></b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
generates code like this for <b><tt>u8 rgb</tt></b>:
<blockquote><b><tt>d_r+=2;</tt></b>
<br><b><tt>d_g+=2;</tt></b>
<br><b><tt>d_b+=2;</tt></b>
<br><b><tt>d_a+=2;</tt></b>
<br><b><tt></tt></b>&nbsp;</blockquote>
<b><tt>3)</tt></b>
<br><b><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; dX(s,1);</tt></b>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
generates code like this for <b><tt>u8 rgb</tt></b>:
<blockquote><b><tt>s_r++;</tt></b>
<br><b><tt>s_g++;</tt></b>
<br><b><tt>s_b++;</tt></b>
<br><b><tt>if (s_has_alpha)</tt></b>
<br><b><tt>&nbsp; s_a++;</tt></b></blockquote>

<div 
CLASS="TOC"
>
<dl 
>
<hr></dl>
</div>

<div 
CLASS="SECT1"
>
<h1 CLASS="SECT1">
<a NAME="Generic Image Language Program"></a><font size=+2>Generic Image
Language Program</font></h1>

<div CLASS="SECT1"><font size=+0>To generate code for several different
color spaces and data types for each bit of generic image code, we need
to introduce the idea of a generic image program.&nbsp; A program is defined
by the following:</font>
<p><b><tt>GENERIC_IMAGE_PROGRAM colormodels_file</tt></b>
<br><b><tt>void</tt></b></div>

<div CLASS="SECT1"><b><tt>some_function_COLORSPACE_DATATYPE(...)</tt></b>
<br><b><tt>GENERIC_IMAGE_CODEGEN_BEGIN</tt></b>
<br><b><tt>{</tt></b></div>

<div CLASS="SECT1"><b><tt>GENERIC_IMAGE_DECL_BEGIN</tt></b></div>

<div CLASS="SECT1"><b><tt>GENERIC_IMAGE_DECL_END</tt></b></div>
<b><tt>...</tt></b>
<br><b><tt>GENERIC_IMAGE_DATA_INIT</tt></b>
<br><b><tt>...</tt></b>
<br><b><tt>GENERIC_IMAGE_BLOCK_BEGIN</tt></b>
<br><b><tt>GENERIC_IMAGE_BLOCK_END</tt></b>
<br><b><tt>..</tt></b>
<p><b><tt>}</tt></b>
<br><b><tt>GENERIC_IMAGE_CODEGEN_END</tt></b>
<div CLASS="AUTHOR">&nbsp;
<br><font size=+0>The new parts here are <b><tt>GENERIC_IMAGE_PROGRAM</tt></b>
, <b><tt>GENERIC_IMAGE_CODEGEN_BEGIN,</tt></b> and <b><tt>GENERIC_IMAGE_CODEGEN_END</tt></b>.
The rest of the blocks are as before.&nbsp; <b><tt>GENERIC_IMAGE_PROGRAM</tt></b>
signals the beginning of a generic image language program. Programs roughly
correspond to one function that contains generic image code. The <b><tt>colormodels_file
</tt></b>is
a file which contains color model information to be used in generating
code. This lists all&nbsp; the colormodels for which we will generate code
for this program. When the code generation is done, the <b><tt>COLORSPACE</tt></b>
and
<b><tt>DATATYPE</tt></b> constants are filled in and the code between
<b><tt>GENERIC_IMAGE_PROGRAM</tt></b>&nbsp;
and <b><tt>GENERIC_IMAGE_CODEGEN_END</tt></b> is generated once for each
color model from the <b><tt>colormodels_file</tt></b>. For example if the
<b><tt>colormodels_file </tt></b>contained the two color models <b><tt>rgb
u8</tt></b> and <b><tt>rgb float</tt></b>, then two versions of the code
would be generated, one for each of these color models. These versions
of the code would be enumerated by the <b><tt>COLORSPACE </tt></b>and
<b><tt>DATATYPE
</tt></b>substitutions
in the name of the function <b><tt>some_function_COLORSPACE_DATATYPE.</tt></b></font></div>
</div>

<div 
CLASS="TOC"
>
<dl 
>
<hr></dl>
</div>

<div 
CLASS="SECT1"
>
<h1 CLASS="SECT1">
<a NAME="Codegen"></a><font size=+2>Codegen</font></h1>

<div CLASS="SECT1"><font size=+0>The codegen program is made from the lex/yacc
specification of the generic image language. It generates code for a particular
choice of channel data type and channel names. It can be run as follows:</font>
<div CLASS="SECT1">&nbsp;
<br><b><tt><font size=+0>>codegen --channel-data-file CHANNEL_DATA_FILE
--channel-names CHANNEL_NAMES</font></tt></b>
<p><font size=+0>It reads from standard input and outputs generated code
to standard output based on the options passed in <b><tt>channel-data-file</tt></b>
and <b><tt>channel-names</tt></b> . The <b><tt>CHANNEL_DATA_FILE</tt></b>
specifies the <b><tt>Chan</tt></b> data type and all the macros and definitions
from the <a href="http://www.mindspring.com/~calvinw/genericChannelData.html">Generic
Channel Data</a> document. This is an ascii file described in&nbsp; the
next section <a href="#Channel Data File">Channel Data File.</a> The <b><tt>CHANNEL_NAMES
</tt></b>argument
is a comma separated list of channel names, with color channels first followed
by the name of the alpha channel. For example for
<b><tt>rgb</tt></b> this
would look like <b><tt>--channel-names red,green,blue,alpha</tt></b>. The
color channel names are used for generating code involving color channels.&nbsp;
The alpha channel name is used for alpha channels that occur in the generated
code. Note that <b><tt>channel-names</tt></b> list always includes names
for the color channels and the alpha channel. Even if a particular program
only uses images without alpha, you must still pass an alpha name to codegen.</font>
<br>
<hr>
<div 
CLASS="SECT1"
>
<h1 CLASS="SECT1">
<a NAME="Channel Data File"></a><font size=+2>Channel Data File</font></h1>

<div CLASS="SECT1"><font size=+0>The Channel Data File is where the macros
and definitions of the <b><tt>Chan</tt></b> type are specified for a particular
color model.&nbsp; Here are some examples of&nbsp; the format of the Channel
Data File:</font>
<p><b><tt><font size=+0><u>examples</u>:</font></tt></b>
<p><b><font size=+0>1)&nbsp; uint8</font></b>
<p><b><tt><font size=+0>DATATYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
guint8</font></tt></b>
<br><b><tt><font size=+0>WP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
255</font></tt></b>
<br><b><tt><font size=+0>WP_NORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
(1/255.0)</font></tt></b>
<br><b><tt><font size=+0>MIN_CHAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0</font></tt></b>
<br><b><tt><font size=+0>MAX_CHAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
255</font></tt></b>
<br><b><tt><font size=+0>ZERO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0</font></tt></b>
<br><b><tt><font size=+0>CHAN_CLAMP_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CLAMP (</font></tt></b>
<br><b><tt><font size=+0>CHAN_CLAMP_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0, 255)</font></tt></b>
<br><b><tt><font size=+0>WP_CLAMP_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
CLAMP (</font></tt></b>
<br><b><tt><font size=+0>WP_CLAMP_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0, 255)</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
INT_MULT (</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_MID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
,</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
)</font></tt></b>
<br><b><tt><font size=+0>ROUND_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
ROUND (</font></tt></b>
<br><b><tt><font size=+0>ROUND_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
)</font></tt></b>
<p><b><tt><font size=+0>2) float</font></tt></b>
<p><b><tt><font size=+0>DATATYPE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
gfloat</font></tt></b>
<br><b><tt><font size=+0>WP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1.0</font></tt></b>
<br><b><tt><font size=+0>WP_NORM&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
1.0</font></tt></b>
<br><b><tt><font size=+0>MIN_CHAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FLT_MIN</font></tt></b>
<br><b><tt><font size=+0>MAX_CHAN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
FLT_MAX</font></tt></b>
<br><b><tt><font size=+0>ZERO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
0.0</font></tt></b>
<br><b><tt><font size=+0>CHAN_CLAMP_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>CHAN_CLAMP_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>WP_CLAMP_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>WP_CLAMP_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_MID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
*</font></tt></b>
<br><b><tt><font size=+0>CHAN_MULT_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>ROUND_PRE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<br><b><tt><font size=+0>ROUND_SUF&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
""</font></tt></b>
<p><font size=+0>This is just an ascii file where the right hand side describes
a string to be used for the entry on the left. These are all related to
definitions described in <a href="http://www.mindspring.com/~calvinw/genericChannelData.html">Generic
Channel Data</a>.</font></div>
</div>

<div 
CLASS="TOC"
>
<dl 
>
<hr></dl>
</div>

<div 
CLASS="SECT1"
>
<h1 CLASS="SECT1">
<a NAME="Multiple Programs Per File"></a><font size=+2>Multiple Programs
Per File</font></h1>

<div CLASS="SECT1"><font size=+0>Multiple generic image language programs
may be used in a single file.&nbsp; Each program should use the syntax
described in <a href="#Generic Image Language Program">Generic Image Language
Programs</a> section above. Note that a program corresponds roughly to
one function that will be generated with different choices of colormodels
based on the <b><tt>colormodels_file.</tt></b> Different programs (routines)
may specify different <b><tt>colormodels_file</tt></b>s, allowing each
program to generate code for different combinations of color models/data
types. A preprocessing program takes care of reading in the file which
contains generic image language programs and searching for <b><tt>GENERIC_IMAGE_PROGRAM.
</tt></b>It
then collects the lines between <b><tt>GENERIC_IMAGE_CODEGEN_BEGIN
</tt></b>and
<b><tt>GENERIC_IMAGE_CODEGEN_END</tt></b> and passes these to <b><tt>codegen</tt></b>
with the appropriate colormodel information (<b><tt>CHANNEL_DATA_FILE</tt></b>
and
<b><tt>CHANNEL_NAMES)</tt></b>. The preprocessing program continues
through the original file calling <b><tt>codegen</tt></b> and generating
code for each generic image language program. This preprocessing program
should also take care of setting up any other code in the original file
that may depend on the to-be-generated functions.</font></div>
</div>
</div>
</div>
</div>

<hr>
<div CLASS="SECT1"><a NAME="References"></a><font size=+2>References</font></div>

<div CLASS="SECT1"><a href="http://www.mindspring.com/~calvinw/genericChannelData.html">Generic
Channel Data</a></div>
</div>
</div>

</body>
</html>
